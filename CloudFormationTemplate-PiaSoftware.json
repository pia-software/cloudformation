{
    "AWSTemplateFormatVersion": "2010-09-09",
    "Metadata": {
        "AWS::CloudFormation::Designer": {
            "06fda684-8f02-4569-87a7-ffb5128d370f": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 120
                },
                "z": 1,
                "embeds": [],
                "dependson": [
                    "86e3274a-bd01-4e2e-a173-c04900ea90e7"
                ]
            },
            "86e3274a-bd01-4e2e-a173-c04900ea90e7": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 210,
                    "y": 120
                },
                "z": 1,
                "embeds": [],
                "dependson": [
                    "06fda684-8f02-4569-87a7-ffb5128d370f"
                ]
            },
            "b97d81c5-d74a-4b81-bd58-0eaa2cfc9c67": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 300,
                    "y": 120
                },
                "z": 1,
                "embeds": []
            },
            "c12cf56d-0949-45cc-b96c-1f1da907d3b6": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 60,
                    "y": 210
                },
                "z": 1,
                "embeds": [],
                "dependson": [
                    "86e3274a-bd01-4e2e-a173-c04900ea90e7"
                ]
            },
            "9285a51b-5859-4b36-a774-b2653276c3b3": {
                "size": {
                    "width": 60,
                    "height": 60
                },
                "position": {
                    "x": 254.23141655489712,
                    "y": 215.41603512651005
                },
                "z": 0,
                "embeds": [],
                "dependson": [
                    "b97d81c5-d74a-4b81-bd58-0eaa2cfc9c67"
                ]
            }
        }
    },
    "Mappings": {
        "RegionMap": {
            "us-east-1": {
                "64": "ami-ade70fd0"
            },
            "us-east-2": {
                "64": "ami-bf093eda"
            }
        }
    },
    "Resources": {
        "FlowLogsViewerIamPolicy": {
            "Type": "AWS::IAM::Policy",
            "Properties": {
                "PolicyName": "FlowLogsViewerIamPolicy",
                "Users": [
                    "FlowLogsViewerUser106"
                ],
                "PolicyDocument": {
                    "Version": "2012-10-17",
                    "Statement": [
                        {
                            "Sid": "Stmt1441998815000",
                            "Effect": "Allow",
                            "Action": [
                                "ec2:DescribeFlowLogs",
                                "ec2:DescribeNetworkInterfaces",
                                "ec2:DescribeRegions",
                                "ec2:DescribeSecurityGroups",
                                "ec2:DescribeInstances",
                                "ec2:DescribeVpcs",
                                "logs:DescribeLogGroups",
                                "logs:DescribeLogStreams",
                                "logs:GetLogEvents"
                            ],
                            "Resource": [
                                "*"
                            ]
                        }
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "06fda684-8f02-4569-87a7-ffb5128d370f"
                }
            },
            "DependsOn": [
                "FlowLogsViewerUser106"
            ]
        },
        "FlowLogsViewerUser106": {
            "Type": "AWS::IAM::User",
            "Properties": {
                "UserName": "FlowLogsViewerUser106"
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "86e3274a-bd01-4e2e-a173-c04900ea90e7"
                }
            },
            "DependsOn": []
        },
        "FlowLogViewerSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "VpcId": {
                    "Ref": "myVPCID"
                },
                "GroupDescription": "Allow http and https to FlowLogsViewer instance",
                "SecurityGroupIngress": [
                    {
                        "IpProtocol": "tcp",
                        "ToPort": "80",
                        "FromPort": "80",
                        "CidrIp": "0.0.0.0/0"
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "443",
                        "ToPort": "443",
                        "CidrIp": {
                            "Ref": "myIPCIDR"
                        }
                    },
                    {
                        "IpProtocol": "tcp",
                        "FromPort": "22",
                        "ToPort": "22",
                        "CidrIp": {
                            "Ref": "myIPCIDR"
                        }
                    }
                ]
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "b97d81c5-d74a-4b81-bd58-0eaa2cfc9c67"
                }
            }
        },
        "FlowLogsViewerUser106AccessKey": {
            "Properties": {
                "UserName": "FlowLogsViewerUser106"
            },
            "Type": "AWS::IAM::AccessKey",
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "c12cf56d-0949-45cc-b96c-1f1da907d3b6"
                }
            },
            "DependsOn": [
                "FlowLogsViewerUser106"
            ]
        },
        "FlowLogsViewerInstance106": {
            "Type": "AWS::EC2::Instance",
            "Properties": {
                "InstanceType": "t2.micro",
                "SecurityGroupIds" : [{ "Ref" : "FlowLogViewerSecurityGroup" }],
                "SubnetId": {
                    "Ref": "mySubnetID"
                },
                "KeyName": {
                    "Ref": "myKeyPair"
                },
                "ImageId": {
                    "Fn::FindInMap": [
                        "RegionMap",
                        {
                            "Ref": "AWS::Region"
                        },
                        "64"
                    ]
                }
            },
            "Metadata": {
                "AWS::CloudFormation::Designer": {
                    "id": "9285a51b-5859-4b36-a774-b2653276c3b3"
                }
            },
            "DependsOn": [
                "FlowLogViewerSecurityGroup"
            ]
        }
    },
    "Outputs": {
        "AccessKeyforAccessKey": {
            "Value": {
                "Ref": "FlowLogsViewerUser106AccessKey"
            }
        },
        "SecretKeyforAccessKey": {
            "Value": {
                "Fn::GetAtt": [
                    "FlowLogsViewerUser106AccessKey",
                    "SecretAccessKey"
                ]
            }
        }
    },
    "Parameters": {
        "myKeyPair": {
            "Description": "Amazon EC2 Key Pair",
            "Type": "AWS::EC2::KeyPair::KeyName"
        },
        "myIPCIDR": {
            "Description": "CIDR block for inbound security group ALLOW to viewer. ex 192.168.1.1/32",
            "Type": "String"
        },
        "myVPCID": {
            "Description": "The VPC to launch the viewer into",
            "Type": "AWS::EC2::VPC::Id"
        },
        "mySubnetID": {
            "Description": "The Subnet to launch the viewer into",
            "Type": "AWS::EC2::Subnet::Id"
        }
    }
}